<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Our Jigsaw Puzzle ðŸ’•</title>
  <style>
    body {
      background: #fff0f6;
      font-family: "Comic Sans MS", cursive, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #ff4081;
    }
    #board {
      position: relative;
      margin: 20px auto;
      width: 600px;
      height: 600px;
      border: 4px solid #ff80ab;
      border-radius: 12px;
      background: #ffccde;
    }
    .piece {
      position: absolute;
      cursor: grab;
    }
    #message {
      margin-top: 20px;
      font-size: 20px;
      color: #d81b60;
      font-weight: bold;
      display: none;
    }
  </style>
</head>
<body>
  <h1>ðŸ’ž Our Special Jigsaw ðŸ’ž</h1>
  <div id="board"></div>
  <div id="message">âœ¨ We're a perfect pair ðŸ’• âœ¨</div>

  <script>
    const rows = 3, cols = 3;
    const pieceSize = 200;
    const board = document.getElementById("board");
    let placed = 0;

    function drawPiece(img, x, y, tabTop, tabRight, tabBottom, tabLeft) {
      let canvas = document.createElement("canvas");
      canvas.width = pieceSize;
      canvas.height = pieceSize;
      let ctx = canvas.getContext("2d");

      ctx.save();
      ctx.beginPath();
      ctx.moveTo(50, 0);

      // top edge
      if (tabTop) {
        ctx.lineTo(75, 0);
        ctx.bezierCurveTo(85, -30 * tabTop, 115, -30 * tabTop, 125, 0);
      }
      ctx.lineTo(pieceSize - 50, 0);

      // right edge
      if (tabRight) {
        ctx.lineTo(pieceSize, 75);
        ctx.bezierCurveTo(pieceSize + 30 * tabRight, 85, pieceSize + 30 * tabRight, 115, pieceSize, 125);
      }
      ctx.lineTo(pieceSize, pieceSize - 50);

      // bottom edge
      if (tabBottom) {
        ctx.lineTo(125, pieceSize);
        ctx.bezierCurveTo(115, pieceSize + 30 * tabBottom, 85, pieceSize + 30 * tabBottom, 75, pieceSize);
      }
      ctx.lineTo(50, pieceSize);

      // left edge
      if (tabLeft) {
        ctx.lineTo(0, 125);
        ctx.bezierCurveTo(-30 * tabLeft, 115, -30 * tabLeft, 85, 0, 75);
      }
      ctx.closePath();
      ctx.clip();

      ctx.drawImage(
        img,
        x * img.width / cols,
        y * img.height / rows,
        img.width / cols,
        img.height / rows,
        0, 0, pieceSize, pieceSize
      );
      ctx.restore();

      return canvas;
    }

    function makePuzzle(img) {
      let pieces = [];
      let tabs = [];

      // generate tab directions (+1 out, -1 in, 0 flat)
      for (let y = 0; y < rows; y++) {
        tabs[y] = [];
        for (let x = 0; x < cols; x++) {
          tabs[y][x] = {
            top: y === 0 ? 0 : -tabs[y-1][x].bottom,
            left: x === 0 ? 0 : -tabs[y][x-1].right,
            bottom: y === rows-1 ? 0 : (Math.random() > 0.5 ? 1 : -1),
            right: x === cols-1 ? 0 : (Math.random() > 0.5 ? 1 : -1)
          };
        }
      }

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          let pieceCanvas = drawPiece(
            img, x, y,
            tabs[y][x].top, tabs[y][x].right, tabs[y][x].bottom, tabs[y][x].left
          );
          pieceCanvas.classList.add("piece");
          pieceCanvas.style.left = Math.random() * (board.offsetWidth - pieceSize) + "px";
          pieceCanvas.style.top = Math.random() * (board.offsetHeight - pieceSize) + "px";

          pieceCanvas.dataset.correctX = x;
          pieceCanvas.dataset.correctY = y;

          makeDraggable(pieceCanvas);
          board.appendChild(pieceCanvas);
          pieces.push(pieceCanvas);
        }
      }
    }

    function makeDraggable(piece) {
      let offsetX, offsetY, dragging = false;

      piece.addEventListener("mousedown", e => {
        dragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        piece.style.zIndex = 1000;
      });

      document.addEventListener("mousemove", e => {
        if (dragging) {
          piece.style.left = (e.pageX - board.offsetLeft - offsetX) + "px";
          piece.style.top = (e.pageY - board.offsetTop - offsetY) + "px";
        }
      });

      document.addEventListener("mouseup", () => {
        if (dragging) {
          dragging = false;
          piece.style.zIndex = "";
          snapToGrid(piece);
        }
      });
    }

    function snapToGrid(piece) {
      const targetX = piece.dataset.correctX * pieceSize;
      const targetY = piece.dataset.correctY * pieceSize;
      const curX = parseInt(piece.style.left);
      const curY = parseInt(piece.style.top);

      if (Math.abs(curX - targetX) < 30 && Math.abs(curY - targetY) < 30) {
        piece.style.left = targetX + "px";
        piece.style.top = targetY + "px";
        piece.draggable = false;
        piece.style.pointerEvents = "none";
        placed++;
        if (placed === rows * cols) {
          document.getElementById("message").style.display = "block";
        }
      }
    }

    let img = new Image();
    img.src = "photo.jpg"; // replace with your photo
    img.onload = () => makePuzzle(img);
  </script>
</body>
</html>
